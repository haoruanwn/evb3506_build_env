# 使用 Buildroot 发送电子邮件

## 1\. 安装软件包

为了通过 `SMTP` 协议发送邮件，需要安装邮件客户端和根证书。

| 软件包               | 用途                                     |
|:----------------- |:-------------------------------------- |
| `msmtp`           | 一个轻量级的 SMTP 客户端，用于从命令行发送电子邮件。          |
| `ca-certificates` | 提供 CA 根证书，用于在 TLS/SSL 安全连接中验证邮件服务器的身份。 |

需要在 Buildroot 的 `menuconfig` 中搜索并开启以上两个软件包。

```bash
./build.sh bconfig
```

**msmtp**

![Snipaste_2025-08-15_20-56-11](https://markdownforyuanhao.oss-cn-hangzhou.aliyuncs.com/img1/20250815212231606.png)

**ca-certificates**

![Snipaste_2025-08-15_19-44-36](https://markdownforyuanhao.oss-cn-hangzhou.aliyuncs.com/img1/20250815212302707.png)

编译并烧录固件后，可以通过以下命令查看 `msmtp` 版本以确认安装成功。

```bash
root@rk3506-buildroot:~# msmtp --version
msmtp version 1.8.24
Platform: arm-buildroot-linux-gnueabihf
TLS/SSL library: OpenSSL
Authentication library: built-in
Supported authentication methods:
plain external cram-md5 login oauthbearer xoauth2 
IDN support: disabled
NLS: disabled
Keyring support: none
System configuration file name: /etc/msmtprc
User configuration file name: /root/.msmtprc

Copyright (C) 2023 Martin Lambers and others.
This is free software.  You may redistribute copies of it under the terms of
the GNU General Public License <http://www.gnu.org/licenses/gpl.html>.
There is NO WARRANTY, to the extent permitted by law.
```

## 2\. 配置邮箱信息

创建并编辑配置文件 `/etc/msmtprc`，填入你的邮箱账户信息。

> **注意**：配置文件中的 `password` 字段应填写邮箱服务商提供的 **SMTP 授权码**，而不是邮箱的登录密码。关于如何获取授权码，可以参考 [如何开启QQ邮件的SMTP服务以及如何使用Python发送邮件](https://blog.csdn.net/qq_42076902/article/details/131900459)。

```bash
# /etc/msmtprc

# 设置默认账户
defaults
auth           on
tls            on
tls_trust_file /etc/ssl/certs/ca-certificates.crt
logfile        ~/.msmtp.log

# 配置QQ邮箱账户
account        qq
host           smtp.qq.com
port           587
from           xxx@qq.com
user           xxx@qq.com
password       xxxxxx

# 设置默认使用的账户
account default : qq
```

## 3\. 发送邮件

配置完成后，使用以下命令即可发送邮件。

```bash
echo -e "Subject: 来自RK3506的测试邮件\n\n您好，\n\n这是一封通过msmtp发送的测试邮件。" | msmtp xxx@qq.com
```